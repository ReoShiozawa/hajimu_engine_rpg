# hajimu_engine_rpg

> **はじむ言語**向け RPG ゲームエンジン

ターン制バトル・キャラクター/アイテム/スキル DB・ダイアログシステム・セーブ/ロード・フラグ/変数管理を提供します。  
`hajimu_engine_render` と `hajimu_engine_ui` を組み合わせて本格的な RPG が作れます。

---

## 特徴

- **ターン制バトル** — SPD 順で行動、通常攻撃 / スキル / アイテム / 防御 / 逃走  
- **データベース** — アクター 64体 / アイテム 256種 / スキル 128種  
- **インベントリ** — アイテム所持数管理 (64スロット)  
- **ダイアログ** — キューイング、文字送りアニメ、話者名付きメッセージ  
- **フラグ / 変数** — 文字列キーで管理 (各 256件)  
- **セーブ / ロード** — バイナリ形式、9スロット制  

---

## 依存

| 要件 | 詳細 |
|---|---|
| はじむ (nihongo) | v0.9 以上 |
| C11 コンパイラ | clang / gcc |
| CMake | 3.15 以上 |

---

## インストール

### 推奨: はじむパッケージマネージャー

```bash
hajimu パッケージ 追加 ReoShiozawa/hajimu_engine_rpg
```

### ソースからビルド

```bash
git clone https://github.com/ReoShiozawa/hajimu_engine_rpg.git
cd hajimu_engine_rpg

make          # → build/engine_rpg.hjp
make install  # → ~/.hajimu/plugins/engine_rpg/
```

---

## クイックスタート

```jp
取込「engine_rpg」

# アクター登録 (id, 名前, HP, MP, ATK, DEF, SPD)
アクター初期化(1, "勇者",   100, 50, 30, 15, 20)
アクター初期化(2, "スライム", 40,  0, 12,  5, 10)

# バトル開始 (パーティ=[1], 敵=[2])
変数「バトル」 = バトル開始([1], [2])

# 攻撃アクション (actor=1, type=0=攻撃, target=2, param=0)
バトルアクション(「バトル」, 1, 0, 2, 0)

表示(「バトル」の最後のメッセージ)

# ダイアログ
ダイアログ初期化()
ダイアログ追加("こんにちは！", "村人")
ループ開始
    ダイアログ更新(デルタ時間())
    変数「msg」 = 現在のメッセージ()
    もし 「msg」 != null ならば
        文字描画(フォントID, 「msg」のテキスト, 10, 400)
    終わり
ループ終わり
```

---

## API リファレンス

### アクター DB

| 関数 | 引数 | 戻り値 | 説明 |
|---|---|---|---|
| `アクター初期化(id, 名前, HP, MP, ATK, DEF, SPD)` | — | null | アクター登録 |
| `アクターHP取得(id)` | int | int | 現在 HP |
| `アクター最大HP取得(id)` | int | int | 最大 HP |
| `アクターMP取得(id)` | int | int | 現在 MP |
| `アクターATK取得(id)` | int | int | 攻撃力 |
| `アクターDEF取得(id)` | int | int | 防御力 |
| `アクターSPD取得(id)` | int | int | 素早さ |
| `アクターレベル取得(id)` | int | int | レベル |
| `アクター名前取得(id)` | int | str | 名前 |
| `アクター生存中(id)` | int | bool | HP>0 かどうか |
| `アクターHP設定(id, val)` | — | null | HP 直接変更 |
| `アクターMP設定(id, val)` | — | null | MP 直接変更 |

### アイテム DB

| 関数 | 引数 | 戻り値 | 説明 |
|---|---|---|---|
| `アイテム初期化(id, 名前, 説明, type, 効果, 価格)` | — | null | アイテム登録 |
| `アイテム名前取得(id)` | int | str | — |
| `アイテム効果取得(id)` | int | int | — |
| `アイテム価格取得(id)` | int | int | — |

type: `0`=回復 `1`=装備 `2`=キーアイテム

### スキル DB

| 関数 | 引数 | 戻り値 | 説明 |
|---|---|---|---|
| `スキル初期化(id, 名前, 説明, MP消費, 威力, 対象)` | — | null | スキル登録 |
| `スキル名前取得(id)` | int | str | — |
| `スキルMP消費取得(id)` | int | int | — |
| `スキル威力取得(id)` | int | int | — |

対象: `0`=単体敵 `1`=全体敵 `2`=単体味方 `3`=自分

### インベントリ

| 関数 | 引数 | 戻り値 | 説明 |
|---|---|---|---|
| `アイテム追加(item_id, count)` | — | null | 所持数を増やす |
| `アイテム削除(item_id, count)` | — | null | 所持数を減らす |
| `アイテム所持数(item_id)` | int | int | 現在の所持数 |
| `アイテム所持中(item_id)` | int | bool | count > 0 |

### バトル

| 関数 | 引数 | 戻り値 | 説明 |
|---|---|---|---|
| `バトル開始(party_ids, enemy_ids)` | — | null | バトル初期化 |
| `バトルアクション(type, actor, target, param)` | — | null | 行動処理 |
| `バトル確認()` | — | int | 0=進行中 1=勝利 2=敗北 3=逃走 |
| `次のアクター()` | — | int | 次に行動する actor_id |
| `最後のダメージ()` | — | int | 直前アクションのダメージ |
| `最後のメッセージ()` | — | str | バトルログ |
| `ダメージ計算(atk, def)` | — | int | ダメージ量 |
| `経験値獲得(actor_id, exp)` | — | null | 経験値付与・LV UP |

アクション type: `0`=通常攻撃 `1`=スキル `2`=アイテム `3`=防御 `4`=逃走

### ダイアログ

| 関数 | 引数 | 戻り値 | 説明 |
|---|---|---|---|
| `ダイアログ初期化()` | — | null | キューリセット |
| `ダイアログ追加(テキスト, 話者名)` | str, str | null | メッセージをキューへ |
| `ダイアログ更新(dt)` | float | null | 文字送りタイマー更新 |
| `ダイアログ速度設定(秒/文字)` | float | null | デフォルト 0.03 秒 |
| `ダイアログ次へ()` | — | null | 現在メッセージを完了し次へ |
| `現在メッセージテキスト()` | — | str | 表示中テキスト (空は "") |
| `現在メッセージ話者()` | — | str | 話者名 |
| `現在メッセージ完了()` | — | bool | 全文表示済みか |
| `ダイアログ空か()` | — | bool | キューが空か |

### フラグ / 変数

| 関数 | 引数 | 戻り値 | 説明 |
|---|---|---|---|
| `フラグ設定(key, val)` | str, bool | null | フラグをセット (最大 256) |
| `フラグ取得(key)` | str | bool | フラグを取得 |
| `変数設定(key, val)` | str, float | null | 変数をセット (最大 256) |
| `変数取得(key)` | str | float | 変数を取得 |

### セーブ / ロード

| 関数 | 引数 | 戻り値 | 説明 |
|---|---|---|---|
| `セーブ(slot)` | int (1-9) | bool | 全データをセーブ |
| `ロード(slot)` | int (1-9) | bool | データを復元 |
| `セーブ存在確認(slot)` | int | bool | — |
| `セーブ削除(slot)` | int | null | — |

セーブ先: `~/.hajimu/saves/save_XX.dat`

---

## サンプル

- [examples/hello_rpg.jp](examples/hello_rpg.jp) — バトル・ダイアログ・セーブのデモ

---

## ライセンス

MIT License — Copyright (c) 2026 Reo Shiozawa
